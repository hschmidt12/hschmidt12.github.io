---
title: "Publications"
format: 
  html:
    link-external-newwindow: true
aliases: 
  - /publications
css: website.css
---
<p style="font-size: 0.7rem;"><em>* denotes equal contribution</em></p>

```{r, echo=FALSE, message=FALSE, warning=FALSE, results = "asis"}
# formatting inspired by the fantastic Maureen Ritchey: 
# https://github.com/memobc/memobc.github.io

library(tidyverse)
library(htmltools)
library(glue)
library(knitr)

# read in publication csv 
papers <- read_csv("publications/publications.csv")

# clean up text to ensure all characters encode correctly
clean_text <- function(x) {
  if (is.character(x)) iconv(x, from = "", to = "UTF-8", sub = "byte") else x}
papers <- papers |> mutate(across(everything(), clean_text))

# generate HTML by year
cards_by_year <- map_chr(
  sort(unique(papers$year), decreasing = TRUE),
  function(y) {
    papers_year <- papers |> filter(year == y)
    paper_cards <- map_chr(1:nrow(papers_year), function(i) {
      row <- papers_year[i, ]
      title <- row$title
      authors <- row$authors
      journal <- row$journal
      paper_link <- row$paper_url
      data_code_link <- row$data_url
      abstract <- row$abstract
      
      # make y safe for HTML
      safe_y <- gsub("[^a-zA-Z0-9]", "", y) # removes spaces, punctuation, etc.

      reference <- paste0(authors, ". (", y, "). <i>", journal, "</i>.")
      abstract_id <- paste0("abstract", safe_y, "_", i)
      toggle_function <- paste0("toggleAbstract", safe_y, "_", i)

      code_icon <- if (!is.na(data_code_link) && data_code_link != "") {
        glue('<a href="{data_code_link}" class="icon-link" target="_blank" title="data & code"><i class="bi bi-code-slash"></i></a>')
      } else { "" }

      abstract_icon <- if (!is.na(abstract) && abstract != "") {
        glue('<a href="#" class="icon-link" onclick="event.preventDefault(); {toggle_function}()" title="show abstract"><i class="bi bi-card-text"></i></a>')
      } else { "" }

      abstract_html <- if (!is.na(abstract) && abstract != "") {
        glue('<div id="{abstract_id}" class="abstract-text" style="display:none;">
                <p><strong>Abstract:</strong> {abstract}</p>
              </div>
              <script>
                function {toggle_function}() {{
                  var abstractDiv = document.getElementById("{abstract_id}");
                  if (abstractDiv.style.display === "none" || abstractDiv.style.display === "") {{
                    abstractDiv.style.display = "block";
                  }} else {{
                    abstractDiv.style.display = "none";
                  }}
                }}
              </script>')
      } else { "" }

      glue('<div class="paper-row">
              <div class="paper-title">
                <a href="{paper_link}" class="paper-link" target="_blank">{title}</a>
                <p class="paper-ref">{reference} {code_icon} {abstract_icon}</p>
                {abstract_html}
              </div>
            </div>')
    })

    glue('
  <div class="year-group">
    <div class="paper-year">{y}</div>
    <div class="year-papers">
      {paste(paper_cards, collapse = "")}
    </div>
  </div>
  <div class="year-divider"></div>')
  }
)

asis_output(paste(cards_by_year, collapse = "\n"))

```





